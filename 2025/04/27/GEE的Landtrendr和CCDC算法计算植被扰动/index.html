<!DOCTYPE html>
<html 
	lang="en/zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
<link rel="stylesheet" href="/css/layout.css">

		
		<title> GEE的Landtrendr和CCDC算法计算植被扰动 -  好想摸鱼</title>
		<!-- <link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css" /> -->
		<!-- <script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script> -->
		
<link rel="stylesheet" href="/lib/mdui/mdui.min.css">

		
<script src="/lib/mdui/mdui.min.js"></script>

		<!-- lazyload -->
		
<script src="/lib/lazysizes.js"></script>

		<!-- smooth-scrolling -->
		
<script src="/lib/smooth-scrolling.js"></script>

		<!-- highlight -->
		
<link rel="stylesheet" href="/lib/highlight/atom-one-dark.min.css">

		
<script src="/lib/highlight/highlight.min.js"></script>

		<!-- 预置 kiraicon -->
		
<link rel="stylesheet" href="/lib/iconfont/iconfont.css">

		
		<link
			rel="shortcut icon"
			href="/img/icon.JPG"
			type="image/png"
		/>
		
<link rel="stylesheet" href="/deps/css/APlayer.min.css">

		
		
<script src="/deps/js/APlayer.min.js"></script>
<script src="/deps/js/Meting.min.js"></script>

	<meta name="generator" content="Hexo 7.3.0"></head>

	<body>
		<div
			class="kira-background"
			style="background-image: url('/img/new-banner.JPG')"
		></div>
		<div class="kira-header">
    <a
        class="kira-drawer-button mdui-ripple"
        title="导航栏"
        onclick="document.querySelector('.kira-sidebar-modal').classList.add('show');document.querySelector('.kira-sidebar#sidebar').classList.add('show');"
    >
        <i class="kirafont icon-menu"></i>
    </a>
    <a href="/" title="好想摸鱼">
        <img
			src="/img/logo.JPG"
			alt="秋月"
		/>
    </a>
</div>
		<div class="kira-body">
			<div class="kira-sidebar" id="sidebar">
	<div class="kira-avatar mdui-ripple">
		<a href="/img/logo.JPG" title="秋月">
			<img
				src="/img/logo.JPG"
				alt="秋月"
			/>
		</a>
	</div>
	<div class="kira-count">
		<div><span>文章</span>4</div>
		<div><span>标签</span>6</div>
		<div><span>分类</span>3</div>
	</div>
	<div class="kira-list">
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/"
			title="回到首页"
		>
			<i
				class="kirafont
					
						icon-home
					"
			></i>
			<div class="kira-list-item-content">
				回到首页
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/archive.html"
			title="文章归档"
		>
			<i
				class="kirafont
					
						icon-container
					"
			></i>
			<div class="kira-list-item-content">
				文章归档
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/about.html"
			title="关于本人"
		>
			<i
				class="kirafont
					
						icon-user
					"
			></i>
			<div class="kira-list-item-content">
				关于本人
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/friends.html"
			title="我的朋友"
		>
			<i
				class="kirafont
					
						icon-team
					"
			></i>
			<div class="kira-list-item-content">
				我的朋友
			</div>
		</a>
		
	</div>
	<aside id="kira-sidebar">
		
			<div class="kira-widget-wrap">
	<div class="kira-widget kira-social">
		
			<a
				class="mdui-ripple"
				href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=2116596217&website=www.oicqzone.com"
				target="_blank"
				mdui-tooltip="{content: 'QQ'}"
				style="color: rgb(49, 174, 255); background-color: rgba(49, 174, 255, .1);"
			>
				<i
					class="kirafont
					
						icon-QQ
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://space.bilibili.com/4316572"
				target="_blank"
				mdui-tooltip="{content: '哔哩哔哩'}"
				style="color: rgb(231, 106, 141); background-color: rgba(231, 106, 141, .15);"
			>
				<i
					class="kirafont
					
						icon-bilibili
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://github.com/yamakaze1234/"
				target="_blank"
				mdui-tooltip="{content: 'GitHub'}"
				style="color: rgb(25, 23, 23); background-color: rgba(25, 23, 23, .15);"
			>
				<i
					class="kirafont
					
						icon-github
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://gitee.com/autumn-moonyamakaze"
				target="_blank"
				mdui-tooltip="{content: 'Gitee'}"
				style="color: rgb(165, 15, 15); background-color: rgba(165, 15, 15, .15);"
			>
				<i
					class="kirafont
					
						icon-gitee
					"
				></i>
			</a>
		
	</div>
</div>

		
			
  <div class="kira-widget-wrap">
    <h3 class="kira-widget-title">分类</h3>
    <div class="kira-widget">
      <ul class="category-list">
        
        

        
          <li class="category-list-item">
            <a class="category-list-link" href="/categories/代码学习/">
              代码学习
            </a>
            <span class="category-list-count">1</span>
          </li>
        
          <li class="category-list-item">
            <a class="category-list-link" href="/categories/博客创建/">
              博客创建
            </a>
            <span class="category-list-count">1</span>
          </li>
        
          <li class="category-list-item">
            <a class="category-list-link" href="/categories/菜谱/">
              菜谱
            </a>
            <span class="category-list-count">2</span>
          </li>
        
      </ul>
    </div>
  </div>

		
			
	<div class="kira-widget-wrap">
		<div id="randomtagcloud" class="kira-widget tagcloud kira-rainbow">
			<a href="/tags/GEE/" style="font-size: 10px;">GEE</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E8%8F%9C%E8%B0%B1/" style="font-size: 20px;">菜谱</a> <a href="/tags/%E9%81%A5%E6%84%9F/" style="font-size: 10px;">遥感</a>
		</div>
		
	</div>


		
			
	<div class="kira-widget-wrap">
		<h3 class="kira-widget-title">
			文章归档
		</h3>
		<div class="kira-widget">
			<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/">2025</a><span class="archive-list-count">4</span></li></ul>
		</div>
	</div>


		
	</aside>
	<div class="kira-copyright">
		&copy; 2025
		<a href="/">秋月</a>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> &
		<a href="https://github.com/ch1ny/kira-hexo/" target="_blank">Kira-Hexo</a>
		<br />
		
		
	</div>
</div>
<div
	class="kira-sidebar-modal"
	id="sidebar-modal"
	onclick="(function(self) {
		self.classList.remove('show');
		document.querySelector('.kira-sidebar.show#sidebar').classList.remove('show');
	})(this)"
></div>
			<div class="kira-content">
				<div id="kira-top-header"></div>
				<div class="kira-main-content">
					
<link rel="stylesheet" href="/css/kira-image.css">


<script src="/js/kira-image.js"></script>

<div class="kira-image">
    <div class="kira-image-modal">
        <div class="kira-image-header">
            <div class="kira-image-counter"></div>
            <div class="kira-image-title"></div>
            <div class="kira-image-operation">
                <div class="kira-image-operation-button" id="kira-image-operation-button-zoom">
                    <i class="kirafont icon-zoom-in"></i>
                </div>
                <div class="kira-image-operation-button" id="kira-image-operation-button-close">
                    <i class="kirafont icon-close"></i>
                </div>
            </div>
        </div>
        <div class="kira-image-container">
            <div class="kira-image-prev-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-left"></i>
                </div>
            </div>
            <div class="kira-image-list">
                <div class="kira-image-prev">
                    <img />
                </div>
                <div class="kira-image-now">
                    <img />
                </div>
                <div class="kira-image-next">
                    <img />
                </div>
            </div>
            <div class="kira-image-next-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-right"></i>
                </div>
            </div>
        </div>
    </div>
</div>

	
<link rel="stylesheet" href="/css/kira-code-copy.css">

	
<script src="/js/kira-code-copy.js"></script>


<div class="kira-post">
	<article>
		
		<div class="kira-post-cover">
			<img
				data-src="/img/lt_gee_symbols.png"
				data-sizes="auto"
				alt="GEE的Landtrendr和CCDC算法计算植被扰动"
				class="lazyload kira-post-cover-image disabled-kira-image"
			/>
			<h1>GEE的Landtrendr和CCDC算法计算植被扰动</h1>
		</div>
		
		<div class="kira-post-meta kira-rainbow" style="margin:10px 0!important;">
			<a><i class="kirafont icon-calendar-fill"></i>2025年04月27日</a>
			<a><i class="kirafont icon-edit-fill"></i>4.2k 字</a>
			<a><i class="kirafont icon-time-circle-fill"></i>大概 21 分钟</a>
		</div>
		<html><head></head><body><p>毕设做的是GEE上Landtrendr和CCDC森林干扰识别相关的，其实大部分都是模仿复现，磕磕绊绊做了挺久，还是学习到一些内容的，虽然感觉以后也不会碰这方面的了，整理保存一下。</p>
<h1><span id="landtrendr">Landtrendr</span></h1><h2><span id="%E7%AE%97%E6%B3%95%E4%BB%8B%E7%BB%8D">算法介绍</span></h2><h3><span id="landtrendr%E7%AE%80%E4%BB%8B"><strong>Landtrendr简介</strong></span></h3><ol>
<li><p>Landtrendr 算法基于支持向量机（Support Vector Machine, SVM）和回归树（Regression Tree, RT）等机器学习方法和时间序列分析理论，能够处理大规模的地表覆盖数据，广泛应用于植被扰动研究中。</p>
</li>
<li><p>Landtrendr 算法的优点是可同时监测出森林干扰和恢复发生的时间、地点、面积和强度，可通过设置光谱时间轨迹的参数减少时间分割过程中出现的过拟合问题和背景噪声，适用于同源遥感数据。</p>
</li>
<li><p>Landtrendr 算法的核心思想是将原始复杂的时间序列轨迹，通过滤波和分隔简化为一组连续、正常的序列，然后对分隔后的分段进行线性拟合，提出重点信息。</p>
</li>
</ol>
<p><img src="/2025/04/27/GEE%E7%9A%84Landtrendr%E5%92%8CCCDC%E7%AE%97%E6%B3%95%E8%AE%A1%E7%AE%97%E6%A4%8D%E8%A2%AB%E6%89%B0%E5%8A%A8/Landtrendr.png"></p>
<h3><span id="landtrendr%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3%E6%88%90%E6%9E%9C"><strong>Landtrendr算法相关成果</strong></span></h3><p>Kennedy R E, Yang Z, Cohen W B. Detecting trends in forest disturbance and recovery using yearly Landsat time series: 1. LandTrendr—Temporal segmentation algorithms[J]. Remote Sensing of Environment, 2010, 114(12): 2897-2910.</p>
<p>苏文瑞, 田佳, 杨泽康, 等. 基于GEE和LandTrendr的宁夏“三山”森林干扰监测[J]. 中国水土保持科学(中英文), 2022, 20(06): 41-49.</p>
<p> Kennedy R E, Yang Z, Gorelick N, et al. Implementation of the LandTrendr algorithm on google earth engine[J]. Remote Sensing, 2018, 10(5): 691.</p>
<h3><span id="%E7%9B%B8%E5%85%B3%E7%BD%91%E5%9D%80">相关<strong>网址</strong></span></h3><p><a target="_blank" rel="noopener" href="https://code.earthengine.google.com/?accept_repo=users/emaprlab/public">https://code.earthengine.google.com/?accept_repo=users/emaprlab/public</a></p>
<h4><span id="lt-gee-guide">LT-GEE Guide</span></h4><p><a target="_blank" rel="noopener" href="https://emapr.github.io/LT-GEE/">https://emapr.github.io/LT-GEE/</a></p>
<h4><span id="lt-gee-pixel-time-series">LT-GEE Pixel Time Series</span></h4><p><a target="_blank" rel="noopener" href="https://emaprlab.users.earthengine.app/view/lt-gee-pixel-time-series">https://emaprlab.users.earthengine.app/view/lt-gee-pixel-time-series</a></p>
<h4><span id="lt-gee-change-mapper">LT-GEE Change Mapper</span></h4><p><a target="_blank" rel="noopener" href="https://emaprlab.users.earthengine.app/view/lt-gee-change-mapper">https://emaprlab.users.earthengine.app/view/lt-gee-change-mapper</a></p>
<h3><span id="landtrendr%E4%BB%A3%E7%A0%81">Landtrendr代码</span></h3><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//######################################################################################################## </span><br><span class="hljs-comment">//#                                                                                                    #\\</span><br><span class="hljs-comment">//#                           LANDTRENDR GREATEST DISTURBANCE MAPPING                                  #\\</span><br><span class="hljs-comment">//#                                                                                                    #\\</span><br><span class="hljs-comment">//########################################################################################################</span><br> <br> <br><span class="hljs-comment">// date: 2018-10-07</span><br><span class="hljs-comment">// author: Justin Braaten | jstnbraaten@gmail.com</span><br><span class="hljs-comment">//         Zhiqiang Yang  | zhiqiang.yang@oregonstate.edu</span><br><span class="hljs-comment">//         Robert Kennedy | rkennedy@coas.oregonstate.edu</span><br><span class="hljs-comment">// parameter definitions: https://emapr.github.io/LT-GEE/api.html#getchangemap</span><br><span class="hljs-comment">// website: https://github.com/eMapR/LT-GEE</span><br><span class="hljs-comment">// notes: </span><br><span class="hljs-comment">//   - you must add the LT-GEE API to your GEE account to run this script. </span><br><span class="hljs-comment">//     Visit this URL to add it:</span><br><span class="hljs-comment">//     https://code.earthengine.google.com/?accept_repo=users/emaprlab/public</span><br><span class="hljs-comment">//   - use this app to help parameterize: </span><br><span class="hljs-comment">//     https://emaprlab.users.earthengine.app/view/lt-gee-change-mapper</span><br> <br> <br><span class="hljs-comment">//##########################################################################################</span><br><span class="hljs-comment">// START INPUTS</span><br><span class="hljs-comment">//##########################################################################################</span><br> <br> <br><span class="hljs-keyword">var</span> aoi = table;<br><span class="hljs-comment">//1.加载并显示研究区边界</span><br><span class="hljs-comment">// 在地图中央加载研究区边界，显示黄色</span><br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">centerObject</span>(aoi, <span class="hljs-number">10</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(aoi, {<span class="hljs-string">'color'</span>: <span class="hljs-string">'yellow'</span>}, <span class="hljs-string">'研究区'</span>);<br> <br><span class="hljs-comment">// define collection parameters</span><br><span class="hljs-keyword">var</span> startYear = <span class="hljs-number">2000</span>;<br><span class="hljs-keyword">var</span> endYear = <span class="hljs-number">2015</span>;<br><span class="hljs-keyword">var</span> startDay = <span class="hljs-string">'06-20'</span>;<br><span class="hljs-keyword">var</span> endDay = <span class="hljs-string">'09-20'</span>;<br><span class="hljs-comment">//var aoi = ee.Geometry.Point(-122.8848, 43.7929);</span><br><span class="hljs-keyword">var</span> index = <span class="hljs-string">'NBR'</span>;<br><span class="hljs-keyword">var</span> maskThese = [<span class="hljs-string">'cloud'</span>, <span class="hljs-string">'shadow'</span>, <span class="hljs-string">'snow'</span>, <span class="hljs-string">'water'</span>];<br> <br><span class="hljs-comment">// define landtrendr parameters</span><br><span class="hljs-keyword">var</span> runParams = { <br>  <span class="hljs-attr">maxSegments</span>:            <span class="hljs-number">6</span>,<br>  <span class="hljs-attr">spikeThreshold</span>:         <span class="hljs-number">0.9</span>,<br>  <span class="hljs-attr">vertexCountOvershoot</span>:   <span class="hljs-number">3</span>,<br>  <span class="hljs-attr">preventOneYearRecovery</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">recoveryThreshold</span>:      <span class="hljs-number">0.25</span>,<br>  <span class="hljs-attr">pvalThreshold</span>:          <span class="hljs-number">0.05</span>,<br>  <span class="hljs-attr">bestModelProportion</span>:    <span class="hljs-number">0.75</span>,<br>  <span class="hljs-attr">minObservationsNeeded</span>:  <span class="hljs-number">6</span><br>};<br> <br><span class="hljs-comment">// define change parameters</span><br><span class="hljs-keyword">var</span> changeParams = {<br>  <span class="hljs-attr">delta</span>:  <span class="hljs-string">'loss'</span>,<br>  <span class="hljs-attr">sort</span>:   <span class="hljs-string">'greatest'</span>,<br>  <span class="hljs-attr">year</span>:   {<span class="hljs-attr">checked</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">start</span>:<span class="hljs-number">2000</span>, <span class="hljs-attr">end</span>:<span class="hljs-number">2015</span>},<br>  <span class="hljs-attr">mag</span>:    {<span class="hljs-attr">checked</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>:<span class="hljs-number">200</span>,  <span class="hljs-attr">operator</span>:<span class="hljs-string">'&gt;'</span>},<br>  <span class="hljs-attr">dur</span>:    {<span class="hljs-attr">checked</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>:<span class="hljs-number">4</span>,    <span class="hljs-attr">operator</span>:<span class="hljs-string">'&lt;'</span>},<br>  <span class="hljs-attr">preval</span>: {<span class="hljs-attr">checked</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>:<span class="hljs-number">300</span>,  <span class="hljs-attr">operator</span>:<span class="hljs-string">'&gt;'</span>},<br>  <span class="hljs-attr">mmu</span>:    {<span class="hljs-attr">checked</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>:<span class="hljs-number">11</span>},<br>};<br> <br><span class="hljs-comment">//##########################################################################################</span><br><span class="hljs-comment">// END INPUTS</span><br><span class="hljs-comment">//##########################################################################################</span><br> <br><span class="hljs-comment">// load the LandTrendr.js module</span><br><span class="hljs-keyword">var</span> ltgee = <span class="hljs-built_in">require</span>(<span class="hljs-string">'users/emaprlab/public:Modules/LandTrendr.js'</span>); <br> <br><span class="hljs-comment">// add index to changeParams object</span><br>changeParams.<span class="hljs-property">index</span> = index;<br> <br><span class="hljs-comment">// run landtrendr</span><br><span class="hljs-keyword">var</span> lt = ltgee.<span class="hljs-title function_">runLT</span>(startYear, endYear, startDay, endDay, aoi, index, [], runParams, maskThese);<br> <br><span class="hljs-comment">// get the change map layers</span><br><span class="hljs-keyword">var</span> changeImg = ltgee.<span class="hljs-title function_">getChangeMap</span>(lt, changeParams);<br> <br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Landtrend Bands'</span>, changeImg);<br> <br><span class="hljs-comment">// 这些颜色分别是紫色、靛蓝色、蓝色、绿色、黄色、橙色和红色</span><br><span class="hljs-keyword">var</span> palette = [<span class="hljs-string">'#9400D3'</span>, <span class="hljs-string">'#4B0082'</span>, <span class="hljs-string">'#0000FF'</span>, <span class="hljs-string">'#00FF00'</span>, <span class="hljs-string">'#FFFF00'</span>, <span class="hljs-string">'#FF7F00'</span>, <span class="hljs-string">'#FF0000'</span>];<br><span class="hljs-keyword">var</span> yodVizParms = {<br>  <span class="hljs-attr">min</span>: startYear,<br>  <span class="hljs-attr">max</span>: endYear,<br>  <span class="hljs-attr">palette</span>: palette<br>};<br> <br><span class="hljs-keyword">var</span> magVizParms = {<br>  <span class="hljs-attr">min</span>: <span class="hljs-number">200</span>,<br>  <span class="hljs-attr">max</span>: <span class="hljs-number">800</span>,<br>  <span class="hljs-attr">palette</span>: palette<br>};<br> <br><span class="hljs-keyword">var</span> changeImg = changeImg.<span class="hljs-title function_">clip</span>(aoi);<br> <br><span class="hljs-comment">// display the change attribute map - note that there are other layers - print changeImg to console to see all</span><br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">centerObject</span>(aoi, <span class="hljs-number">11</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(changeImg.<span class="hljs-title function_">select</span>([<span class="hljs-string">'mag'</span>]), magVizParms, <span class="hljs-string">'Magnitude of Change'</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(changeImg.<span class="hljs-title function_">select</span>([<span class="hljs-string">'yod'</span>]), yodVizParms, <span class="hljs-string">'Year of Detection'</span>);<br> <br><span class="hljs-comment">// export change data to google drive</span><br><span class="hljs-comment">//var region = aoi.buffer(100000).bounds();</span><br><span class="hljs-keyword">var</span> exportImg = changeImg.<span class="hljs-title function_">clip</span>(aoi).<span class="hljs-title function_">unmask</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">short</span>();<br> <br><span class="hljs-keyword">var</span> out_put_image = exportImg.<span class="hljs-title function_">select</span>(<span class="hljs-string">'mag'</span>);      <span class="hljs-comment">//'mag'可以替换'yod'或者'mag'等其他波段</span><br> <br> <br><span class="hljs-title class_">Export</span>.<span class="hljs-property">image</span>.<span class="hljs-title function_">toDrive</span>({<br>  <span class="hljs-attr">image</span>: out_put_image, <br>  <span class="hljs-attr">description</span>: <span class="hljs-string">'2000_2015_mag'</span>, <br>  <span class="hljs-attr">folder</span>: <span class="hljs-string">'landtrendr'</span>, <br>  <span class="hljs-comment">//fileNamePrefix: 'lt-gee_disturbance_map', </span><br>  <span class="hljs-attr">region</span>: aoi, <br>  <span class="hljs-attr">scale</span>: <span class="hljs-number">30</span>, <br>  <span class="hljs-attr">crs</span>: <span class="hljs-string">'EPSG:4326'</span>, <br>  <span class="hljs-attr">maxPixels</span>: <span class="hljs-number">1e13</span><br>});<br></code></pre></td></tr></tbody></table></figure>

<p><strong>波段介绍</strong></p>
<table>
<thead>
<tr>
<th>波段名称</th>
<th>全称</th>
<th>介绍</th>
</tr>
</thead>
<tbody><tr>
<td>yod</td>
<td><strong>Year of Detection</strong></td>
<td>表示检测到变化的年份。它记录了某个地点发生变化的时间。</td>
</tr>
<tr>
<td>mag</td>
<td><strong>Magnitude</strong></td>
<td>反映了变化的程度或强度。它衡量了变化的大小或影响的强度。</td>
</tr>
<tr>
<td>dur</td>
<td><strong>Duration</strong></td>
<td>变化的持续时间。它表示了变化事件发生的时间长度。</td>
</tr>
<tr>
<td>preval</td>
<td><strong>Prevalence</strong></td>
<td>变化的普遍性或分布范围。它指的是变化事件的分布程度或覆盖面积。</td>
</tr>
<tr>
<td>rate</td>
<td><strong>Rate of Change</strong></td>
<td>变化的速率或变化率。它表示了变化发生的快慢程度。</td>
</tr>
<tr>
<td>dsnr</td>
<td><strong>Delta Signal-to-Noise Ratio</strong></td>
<td>变化信号与噪声的比值。它衡量了变化信号与噪声之间的相对强度，用于评估变化检测的准确性和可靠性。</td>
</tr>
</tbody></table>
<h2><span id="%E7%AE%97%E6%B3%95%E7%BB%93%E6%9E%9C%E6%8F%90%E5%8F%96">算法结果提取</span></h2><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 数据预处理</span><br><span class="hljs-comment">// 定义研究区</span><br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'users/parevalo_bu/gee-ccdc-tools:ccdcUtilities/api'</span>);<br><span class="hljs-keyword">var</span> aoi = table.<span class="hljs-title function_">filter</span>(ee.<span class="hljs-property">Filter</span>.<span class="hljs-title function_">eq</span>(<span class="hljs-string">'县'</span>, <span class="hljs-string">'武隆区'</span>));<br><span class="hljs-keyword">var</span> styling = {<span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>, <span class="hljs-attr">fillColor</span>: <span class="hljs-string">'00000000'</span>};<br><br><span class="hljs-comment">// 1. 加载并显示研究区边界</span><br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(aoi.<span class="hljs-title function_">style</span>(styling), {}, <span class="hljs-string">'wlq'</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">centerObject</span>(aoi, <span class="hljs-number">6</span>);<br><br><span class="hljs-comment">// 定义时间参数</span><br><span class="hljs-keyword">var</span> startYear = <span class="hljs-number">1990</span>;<br><span class="hljs-keyword">var</span> endYear = <span class="hljs-number">2020</span>;<br><span class="hljs-keyword">var</span> startDay = <span class="hljs-string">'06-20'</span>;<br><span class="hljs-keyword">var</span> endDay = <span class="hljs-string">'09-20'</span>;<br><br><span class="hljs-comment">// 使用 NDVI 作为索引</span><br><span class="hljs-keyword">var</span> index = <span class="hljs-string">'NDVI'</span>;  <span class="hljs-comment">// NDVI是通过红色波段和近红外波段计算的</span><br><span class="hljs-keyword">var</span> maskThese = [<span class="hljs-string">'cloud'</span>, <span class="hljs-string">'shadow'</span>, <span class="hljs-string">'snow'</span>, <span class="hljs-string">'water'</span>]; <span class="hljs-comment">// 掩模类型</span><br><br><span class="hljs-comment">// 定义 LandTrendr 参数</span><br><span class="hljs-keyword">var</span> runParams = { <br>  <span class="hljs-attr">maxSegments</span>: <span class="hljs-number">6</span>,<br>  <span class="hljs-attr">spikeThreshold</span>: <span class="hljs-number">0.9</span>,<br>  <span class="hljs-attr">vertexCountOvershoot</span>: <span class="hljs-number">3</span>,<br>  <span class="hljs-attr">preventOneYearRecovery</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">recoveryThreshold</span>: <span class="hljs-number">0.25</span>,<br>  <span class="hljs-attr">pvalThreshold</span>: <span class="hljs-number">0.05</span>,<br>  <span class="hljs-attr">bestModelProportion</span>: <span class="hljs-number">0.75</span>,<br>  <span class="hljs-attr">minObservationsNeeded</span>: <span class="hljs-number">6</span><br>};<br><br><span class="hljs-comment">// 定义变化参数</span><br><span class="hljs-keyword">var</span> changeParams = {<br>  <span class="hljs-attr">delta</span>: <span class="hljs-string">'loss'</span>,<br>  <span class="hljs-attr">sort</span>: <span class="hljs-string">'greatest'</span>,<br>  <span class="hljs-attr">year</span>: {<span class="hljs-attr">checked</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">start</span>: <span class="hljs-number">1990</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">2020</span>},<br>  <span class="hljs-attr">mag</span>: {<span class="hljs-attr">checked</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">operator</span>: <span class="hljs-string">'&gt;'</span>},<br>  <span class="hljs-attr">dur</span>: {<span class="hljs-attr">checked</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">operator</span>: <span class="hljs-string">'&lt;'</span>},<br>  <span class="hljs-attr">preval</span>: {<span class="hljs-attr">checked</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">300</span>, <span class="hljs-attr">operator</span>: <span class="hljs-string">'&gt;'</span>},<br>  <span class="hljs-attr">mmu</span>: {<span class="hljs-attr">checked</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">11</span>},<br>};<br><br><span class="hljs-comment">// ##########################################################################################</span><br><span class="hljs-comment">// END INPUTS</span><br><span class="hljs-comment">// ##########################################################################################</span><br><br><span class="hljs-comment">// 使用 Landsat 数据集：选择经过表面反射的 Landsat 数据</span><br><span class="hljs-keyword">var</span> landsatCollection = ee.<span class="hljs-title class_">ImageCollection</span>(<span class="hljs-string">'LANDSAT/LT05/C02/T1_L2'</span>)<br>  .<span class="hljs-title function_">merge</span>(ee.<span class="hljs-title class_">ImageCollection</span>(<span class="hljs-string">'LANDSAT/LE07/C02/T1_L2'</span>))<br>  .<span class="hljs-title function_">merge</span>(ee.<span class="hljs-title class_">ImageCollection</span>(<span class="hljs-string">'LANDSAT/LC08/C02/T1_L2'</span>))<br>  .<span class="hljs-title function_">filterBounds</span>(aoi)  <span class="hljs-comment">// 过滤研究区</span><br>  .<span class="hljs-title function_">filterDate</span>(ee.<span class="hljs-property">Date</span>.<span class="hljs-title function_">fromYMD</span>(startYear, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>), ee.<span class="hljs-property">Date</span>.<span class="hljs-title function_">fromYMD</span>(endYear, <span class="hljs-number">12</span>, <span class="hljs-number">31</span>))  <span class="hljs-comment">// 时间范围</span><br>  .<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">image</span>) {<br>    <span class="hljs-comment">// 计算NDVI</span><br>    <span class="hljs-keyword">var</span> ndvi = image.<span class="hljs-title function_">normalizedDifference</span>([<span class="hljs-string">'B4'</span>, <span class="hljs-string">'B3'</span>]).<span class="hljs-title function_">rename</span>(<span class="hljs-string">'NDVI'</span>);  <span class="hljs-comment">// Landsat 5/7的B4和B3为近红外和红色波段</span><br>    <span class="hljs-keyword">return</span> image.<span class="hljs-title function_">addBands</span>(ndvi);  <span class="hljs-comment">// 将NDVI作为一个新的波段添加到影像中</span><br>  });<br><br><span class="hljs-comment">// 使用 LandTrendr 模块运行变化检测</span><br><span class="hljs-keyword">var</span> ltgee = <span class="hljs-built_in">require</span>(<span class="hljs-string">'users/emaprlab/public:Modules/LandTrendr.js'</span>); <br><br><span class="hljs-comment">// 更新变化参数中的索引为NDVI</span><br>changeParams.<span class="hljs-property">index</span> = index;<br><br><span class="hljs-comment">// 运行LandTrendr</span><br><span class="hljs-keyword">var</span> lt = ltgee.<span class="hljs-title function_">runLT</span>(startYear, endYear, startDay, endDay, aoi, <span class="hljs-string">'NDVI'</span>, [], runParams, maskThese);<br><br><span class="hljs-comment">// 获取变化图层</span><br><span class="hljs-keyword">var</span> changeImg = ltgee.<span class="hljs-title function_">getChangeMap</span>(lt, changeParams);<br><br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Landtrend Bands'</span>, changeImg);<br><br><span class="hljs-comment">// 颜色方案</span><br><span class="hljs-keyword">var</span> palette = [<span class="hljs-string">'#9400D3'</span>, <span class="hljs-string">'#4B0082'</span>, <span class="hljs-string">'#0000FF'</span>, <span class="hljs-string">'#00FF00'</span>, <span class="hljs-string">'#FFFF00'</span>, <span class="hljs-string">'#FF7F00'</span>, <span class="hljs-string">'#FF0000'</span>];<br><span class="hljs-keyword">var</span> yodVizParms = {<br>  <span class="hljs-attr">min</span>: startYear,<br>  <span class="hljs-attr">max</span>: endYear,<br>  <span class="hljs-attr">palette</span>: palette<br>};<br><br><span class="hljs-keyword">var</span> magVizParms = {<br>  <span class="hljs-attr">min</span>: <span class="hljs-number">200</span>,<br>  <span class="hljs-attr">max</span>: <span class="hljs-number">800</span>,<br>  <span class="hljs-attr">palette</span>: palette<br>};<br><br><span class="hljs-comment">// 将变化图像裁剪为研究区边界</span><br>changeImg = changeImg.<span class="hljs-title function_">clip</span>(aoi);<br><br><span class="hljs-comment">// 显示变化图像（包括幅度和变化年份）</span><br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">centerObject</span>(aoi, <span class="hljs-number">11</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(changeImg.<span class="hljs-title function_">select</span>([<span class="hljs-string">'mag'</span>]), magVizParms, <span class="hljs-string">'Magnitude of Change'</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(changeImg.<span class="hljs-title function_">select</span>([<span class="hljs-string">'yod'</span>]), yodVizParms, <span class="hljs-string">'Year of Detection'</span>);<br><br><span class="hljs-comment">// 导出变化数据到Google Drive</span><br><span class="hljs-keyword">var</span> exportImg = changeImg.<span class="hljs-title function_">clip</span>(aoi).<span class="hljs-title function_">unmask</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">short</span>();<br><br><span class="hljs-keyword">var</span> out_put_image = exportImg.<span class="hljs-title function_">select</span>(<span class="hljs-string">'mag'</span>);  <span class="hljs-comment">// 可以替换为 'yod' 或其他波段</span><br><span class="hljs-keyword">var</span> out_put_image_yod = exportImg.<span class="hljs-title function_">select</span>(<span class="hljs-string">'yod'</span>);<br><span class="hljs-title class_">Export</span>.<span class="hljs-property">image</span>.<span class="hljs-title function_">toDrive</span>({<br>  <span class="hljs-attr">image</span>: out_put_image, <br>  <span class="hljs-attr">description</span>: <span class="hljs-string">'1990_2020_mag'</span>, <br>  <span class="hljs-attr">folder</span>: <span class="hljs-string">'landtrendr'</span>, <br>  <span class="hljs-attr">region</span>: aoi, <br>  <span class="hljs-attr">scale</span>: <span class="hljs-number">30</span>, <br>  <span class="hljs-attr">crs</span>: <span class="hljs-string">'EPSG:4326'</span>, <br>  <span class="hljs-attr">maxPixels</span>: <span class="hljs-number">1e13</span><br>});<br><span class="hljs-title class_">Export</span>.<span class="hljs-property">image</span>.<span class="hljs-title function_">toDrive</span>({<br>  <span class="hljs-attr">image</span>: out_put_image_yod, <br>  <span class="hljs-attr">description</span>: <span class="hljs-string">'1990_2020_yod'</span>, <br>  <span class="hljs-attr">folder</span>: <span class="hljs-string">'landtrendr'</span>, <br>  <span class="hljs-attr">region</span>: aoi, <br>  <span class="hljs-attr">scale</span>: <span class="hljs-number">30</span>, <br>  <span class="hljs-attr">crs</span>: <span class="hljs-string">'EPSG:4326'</span>, <br>  <span class="hljs-attr">maxPixels</span>: <span class="hljs-number">1e13</span><br>});<br><br><span class="hljs-comment">// 导出到 Assets</span><br><span class="hljs-title class_">Export</span>.<span class="hljs-property">image</span>.<span class="hljs-title function_">toAsset</span>({<br>  <span class="hljs-attr">image</span>: out_put_image, <br>  <span class="hljs-attr">description</span>: <span class="hljs-string">'LT_mag'</span>, <br>  <span class="hljs-attr">region</span>: aoi, <br>  <span class="hljs-attr">scale</span>: <span class="hljs-number">30</span>, <br>  <span class="hljs-attr">crs</span>: <span class="hljs-string">'EPSG:4326'</span>, <br>  <span class="hljs-attr">maxPixels</span>: <span class="hljs-number">1e13</span>,<br>  <span class="hljs-attr">pyramidingPolicy</span>: { <span class="hljs-string">'.default'</span>: <span class="hljs-string">'sample'</span> },<br>});<br><br><span class="hljs-title class_">Export</span>.<span class="hljs-property">image</span>.<span class="hljs-title function_">toAsset</span>({<br>  <span class="hljs-attr">image</span>: out_put_image_yod, <br>  <span class="hljs-attr">description</span>: <span class="hljs-string">'LT_yod'</span>, <br>  <span class="hljs-attr">region</span>: aoi, <br>  <span class="hljs-attr">scale</span>: <span class="hljs-number">30</span>, <br>  <span class="hljs-attr">crs</span>: <span class="hljs-string">'EPSG:4326'</span>, <br>  <span class="hljs-attr">maxPixels</span>: <span class="hljs-number">1e13</span>,<br>  <span class="hljs-attr">pyramidingPolicy</span>: { <span class="hljs-string">'.default'</span>: <span class="hljs-string">'sample'</span> },<br>});<br></code></pre></td></tr></tbody></table></figure>

<h3><span id="%E6%97%B6%E9%97%B4%E7%B2%BE%E5%BA%A6%E5%88%86%E6%9E%90">时间精度分析</span></h3><p>精度识别结果在CCDC处理中有，主要就是加载目视解译需要的年份，目视解译后导出结果后进行两个算法的时间精度分析</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 载入研究区域</span><br><span class="hljs-keyword">var</span> studyRegion = table.<span class="hljs-title function_">filter</span>(ee.<span class="hljs-property">Filter</span>.<span class="hljs-title function_">eq</span>(<span class="hljs-string">'县'</span>, <span class="hljs-string">'武隆区'</span>));<br><span class="hljs-keyword">var</span> styling = {<span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>, <span class="hljs-attr">fillColor</span>: <span class="hljs-string">'00000000'</span>};<br><span class="hljs-comment">// 加载并显示研究区边界</span><br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(studyRegion.<span class="hljs-title function_">style</span>(styling), {}, <span class="hljs-string">'wlq'</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">centerObject</span>(studyRegion, <span class="hljs-number">10</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(<span class="hljs-title class_">Year</span>.<span class="hljs-title function_">style</span>(styling), {}, <span class="hljs-string">'point'</span>);<br><span class="hljs-comment">// 加载LandTrendr结果</span><br><span class="hljs-keyword">var</span> landTrendrResults = image;<br><br><span class="hljs-comment">// 查看LandTrendr结果的波段</span><br><span class="hljs-title function_">print</span>(<span class="hljs-string">'LandTrendr Results:'</span>, landTrendrResults);<br><br><span class="hljs-comment">// 假设LandTrendr结果中包含变化年份的波段（例如'Year'波段）</span><br><span class="hljs-keyword">var</span> changeYear = landTrendrResults.<span class="hljs-title function_">select</span>(<span class="hljs-string">'yod'</span>); <span class="hljs-comment">// 变化年份</span><br><span class="hljs-comment">// var changeMagnitude = landTrendrResults.select('Magnitude'); // 变化幅度</span><br><span class="hljs-comment">// 设置时间范围并获取满足条件的地点的掩膜</span><br><span class="hljs-keyword">var</span> start = <span class="hljs-number">1990</span>; <span class="hljs-comment">// 修改为你的时间范围</span><br><span class="hljs-keyword">var</span> end = <span class="hljs-number">2000</span>;<br><span class="hljs-keyword">var</span> mask = changeYear.<span class="hljs-title function_">gt</span>(start).<span class="hljs-title function_">and</span>(changeYear.<span class="hljs-title function_">lte</span>(end));<br><br><span class="hljs-comment">// 获取满足时间范围的变化年份</span><br><span class="hljs-keyword">var</span> filteredChangeYear = changeYear.<span class="hljs-title function_">updateMask</span>(mask);<br><span class="hljs-comment">// 定义年份到类别标签的映射（2001-2020）</span><br><span class="hljs-keyword">var</span> yearToLabel = {<br>  <span class="hljs-number">1991</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-number">1992</span>: <span class="hljs-number">2</span>,<br>  <span class="hljs-number">1993</span>: <span class="hljs-number">3</span>,<br>  <span class="hljs-number">1994</span>: <span class="hljs-number">4</span>,<br>  <span class="hljs-number">1995</span>: <span class="hljs-number">5</span>,<br>  <span class="hljs-number">1996</span>: <span class="hljs-number">6</span>,<br>  <span class="hljs-number">1997</span>: <span class="hljs-number">7</span>,<br>  <span class="hljs-number">1998</span>: <span class="hljs-number">8</span>,<br>  <span class="hljs-number">1999</span>: <span class="hljs-number">9</span>,<br>  <span class="hljs-number">2000</span>: <span class="hljs-number">10</span>,<br>};<br><br><span class="hljs-comment">// 将样本点的 year 字段转换为类别标签</span><br><span class="hljs-keyword">var</span> sample_year = <span class="hljs-title class_">Year</span>.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">feature</span>) {<br>  <span class="hljs-comment">// 获取年份字段</span><br>  <span class="hljs-keyword">var</span> year = feature.<span class="hljs-title function_">get</span>(<span class="hljs-string">'year'</span>);<br>  <br>  <span class="hljs-comment">// 检查 year 是否存在且不为空</span><br>  <span class="hljs-keyword">var</span> label = ee.<span class="hljs-property">Algorithms</span>.<span class="hljs-title class_">If</span>(<br>    ee.<span class="hljs-property">Algorithms</span>.<span class="hljs-title class_">IsEqual</span>(year, <span class="hljs-literal">null</span>), <span class="hljs-comment">// 如果 year 为空</span><br>    <span class="hljs-number">0</span>, <span class="hljs-comment">// 设置为 0</span><br>    ee.<span class="hljs-title class_">Dictionary</span>(yearToLabel).<span class="hljs-title function_">get</span>(ee.<span class="hljs-title class_">Number</span>(year).<span class="hljs-title function_">toInt</span>()) <span class="hljs-comment">// 否则获取对应的类别标签</span><br>  );<br>  <br>  <span class="hljs-keyword">return</span> feature.<span class="hljs-title function_">set</span>(<span class="hljs-string">'label'</span>, label); <span class="hljs-comment">// 添加新的字段 label</span><br>});<br><br><span class="hljs-comment">// 将LandTrendr结果的changeYear字段转换为类别标签</span><br><span class="hljs-keyword">var</span> changeYearInt = filteredChangeYear.<span class="hljs-title function_">round</span>(); <span class="hljs-comment">// 将变化年份四舍五入为整数</span><br><br><span class="hljs-comment">// 使用 remap() 将 firstChangeInt 中的年份值映射为对应的类别标签</span><br><span class="hljs-keyword">var</span> changeYearLabel = changeYearInt.<span class="hljs-title function_">remap</span>(<br>  [<span class="hljs-number">1991</span>, <span class="hljs-number">1992</span>, <span class="hljs-number">1993</span>, <span class="hljs-number">1994</span>, <span class="hljs-number">1995</span>, <span class="hljs-number">1996</span>, <span class="hljs-number">1997</span>, <span class="hljs-number">1998</span>, <span class="hljs-number">1999</span>, <span class="hljs-number">2000</span>],  <span class="hljs-comment">// 输入的年份</span><br>  [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>],  <span class="hljs-comment">// 对应的类别标签</span><br>  <span class="hljs-number">0</span>  <span class="hljs-comment">// 默认值为 0，表示未映射的年份</span><br>);<br><br><span class="hljs-comment">// 将转换后的changeYearLabel添加到LandTrendr结果中</span><br><span class="hljs-keyword">var</span> landTrendrResultsWithLabel = landTrendrResults.<span class="hljs-title function_">addBands</span>(changeYearLabel.<span class="hljs-title function_">rename</span>(<span class="hljs-string">'changeYearLabel'</span>));<br><br><span class="hljs-comment">// 提取LandTrendr结果到样本点</span><br><span class="hljs-keyword">var</span> extractedValues = landTrendrResultsWithLabel.<span class="hljs-title function_">sampleRegions</span>({<br>  <span class="hljs-attr">collection</span>: sample_year,<br>  <span class="hljs-attr">scale</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 根据你的数据分辨率调整</span><br>  <span class="hljs-attr">geometries</span>: <span class="hljs-literal">true</span><br>});<br><br><span class="hljs-comment">// 计算混淆矩阵</span><br><span class="hljs-keyword">var</span> confusionMatrix = extractedValues.<span class="hljs-title function_">errorMatrix</span>({<br>  <span class="hljs-attr">actual</span>: <span class="hljs-string">'label'</span>, <span class="hljs-comment">// 使用转换后的类别标签</span><br>  <span class="hljs-attr">predicted</span>: <span class="hljs-string">'changeYearLabel'</span> <span class="hljs-comment">// 使用转换后的类别标签</span><br>});<br><br><span class="hljs-comment">// 打印混淆矩阵</span><br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Confusion Matrix:'</span>, confusionMatrix);<br><br><span class="hljs-comment">// 计算总体精度</span><br><span class="hljs-keyword">var</span> overallAccuracy = confusionMatrix.<span class="hljs-title function_">accuracy</span>();<br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Overall Accuracy:'</span>, overallAccuracy);<br><br><span class="hljs-comment">// 计算Kappa系数</span><br><span class="hljs-keyword">var</span> kappa = confusionMatrix.<span class="hljs-title function_">kappa</span>();<br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Kappa:'</span>, kappa);<br><br><span class="hljs-comment">// 计算用户精度和生产者精度</span><br><span class="hljs-keyword">var</span> userAccuracy = confusionMatrix.<span class="hljs-title function_">consumersAccuracy</span>();<br><span class="hljs-keyword">var</span> producerAccuracy = confusionMatrix.<span class="hljs-title function_">producersAccuracy</span>();<br><span class="hljs-title function_">print</span>(<span class="hljs-string">'User Accuracy:'</span>, userAccuracy);<br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Producer Accuracy:'</span>, producerAccuracy);<br></code></pre></td></tr></tbody></table></figure>

<h1><span id="ccdc">CCDC</span></h1><h2><span id="%E7%AE%97%E6%B3%95%E4%BB%8B%E7%BB%8D">算法介绍</span></h2><h3><span id="ccdc%E7%AE%80%E4%BB%8B">CCDC简介</span></h3><p>连续变化检测与分类（ContinuousChangeDetectionandClassification,CCDC）是一种土地变化监测算法，旨在对卫星数据的时间<br>序列进行操作，特别是Landsat数据。CCDC包括两个部分，其一是变化检测算法(ChangeDetectionComponent,CCD)，其二是分<br>类算法(Classification)。</p>
<p>CCDC组件负责检测地表的变化情况，主要基于时间序列的光谱变化来识别土地覆盖或土地利用的变化。它使用了一个连续的时间序列分<br>析方法，通过对每个像素点拟合一个时间序列模型，来描述每个像素随时间的变化趋势，并检测那些不符合预期模型的行为，从而识<br>别出变化的发生。当模型检测到光谱特征发生显著变化时，认为该像素发生了变化（如土地利用变更、森林砍伐等）。</p>
<p><img src="/2025/04/27/GEE%E7%9A%84Landtrendr%E5%92%8CCCDC%E7%AE%97%E6%B3%95%E8%AE%A1%E7%AE%97%E6%A4%8D%E8%A2%AB%E6%89%B0%E5%8A%A8/CCDC.png"></p>
<h3><span id="ccdc%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3%E6%88%90%E6%9E%9C">CCDC算法相关成果</span></h3><p>Zhu Z, Woodcock C E. Continuous change detection and classification of land cover using all available Landsat data[J]. Remote sensing of Environment, 2014, 144: 152-171.</p>
<p> Zhu Z. Change detection using landsat time series: A review of frequencies, preprocessing, algorithms, and applications[J]. ISPRS Journal of Photogrammetry and Remote Sensing, 2017, 130: 370-384.</p>
<h3><span id="%E7%9B%B8%E5%85%B3%E7%BD%91%E5%9D%80">相关网址</span></h3><h4><span id="app">APP</span></h4><p><a target="_blank" rel="noopener" href="https://parevalo-bu.users.earthengine.app/">https://parevalo-bu.users.earthengine.app/</a></p>
<h4><span id="%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3">说明文档</span></h4><p><a target="_blank" rel="noopener" href="https://gee-ccdc-tools.readthedocs.io/en/latest/ccdc.html">https://gee-ccdc-tools.readthedocs.io/en/latest/ccdc.html</a></p>
<h2><span id="%E7%AE%97%E6%B3%95%E7%BB%93%E6%9E%9C%E6%8F%90%E5%8F%96">算法结果提取</span></h2><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 加载所需的库</span><br><span class="hljs-keyword">var</span> palettes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'users/gena/packages:palettes'</span>);<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'users/parevalo_bu/gee-ccdc-tools:ccdcUtilities/api'</span>);<br><br><span class="hljs-comment">// 载入研究区域</span><br><span class="hljs-keyword">var</span> studyRegion = table.<span class="hljs-title function_">filter</span>(ee.<span class="hljs-property">Filter</span>.<span class="hljs-title function_">eq</span>(<span class="hljs-string">'县'</span>, <span class="hljs-string">'武隆区'</span>));<br><span class="hljs-keyword">var</span> styling = {<span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>, <span class="hljs-attr">fillColor</span>: <span class="hljs-string">'00000000'</span>};<br><br><span class="hljs-comment">// 加载并显示研究区边界</span><br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(studyRegion.<span class="hljs-title function_">style</span>(styling), {}, <span class="hljs-string">'wlq'</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">centerObject</span>(studyRegion, <span class="hljs-number">6</span>);<br><br><span class="hljs-comment">// 查看变化波段</span><br><span class="hljs-comment">// 选择断点时间和变化概率的array images</span><br><span class="hljs-keyword">var</span> change = results.<span class="hljs-title function_">select</span>(<span class="hljs-string">'tBreak'</span>);<br><span class="hljs-keyword">var</span> changeProb = results.<span class="hljs-title function_">select</span>(<span class="hljs-string">'changeProb'</span>);<br><br><span class="hljs-comment">// 设置想要使用的时间范围并获取满足条件的地点的掩膜</span><br><span class="hljs-keyword">var</span> start = <span class="hljs-number">1991</span>; <span class="hljs-comment">// 修改为图示中的年份范围</span><br><span class="hljs-keyword">var</span> end = <span class="hljs-number">2019</span>;<br><span class="hljs-keyword">var</span> mask = change.<span class="hljs-title function_">gt</span>(start).<span class="hljs-title function_">and</span>(change.<span class="hljs-title function_">lte</span>(end)).<span class="hljs-title function_">and</span>(changeProb.<span class="hljs-title function_">eq</span>(<span class="hljs-number">1</span>));<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(changeProb, {}, <span class="hljs-string">'change prob'</span>);<br><br><span class="hljs-comment">// 获取该时间段的断点数</span><br><span class="hljs-keyword">var</span> numBreaks = mask.<span class="hljs-title function_">arrayReduce</span>(ee.<span class="hljs-property">Reducer</span>.<span class="hljs-title function_">sum</span>(), [<span class="hljs-number">0</span>]);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(numBreaks, {<br>  <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">max</span>: <span class="hljs-number">5</span><br>}, <span class="hljs-string">'Number of breaks'</span>);<br><br><span class="hljs-comment">// 获取该时间段内第一次变化</span><br><span class="hljs-keyword">var</span> dates = change.<span class="hljs-title function_">arrayMask</span>(mask).<span class="hljs-title function_">arrayPad</span>([<span class="hljs-number">1</span>]);<br><span class="hljs-keyword">var</span> firstChange = dates<br>  .<span class="hljs-title function_">arraySlice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">arrayFlatten</span>([[<span class="hljs-string">'firstChange'</span>]])<br>  .<span class="hljs-title function_">selfMask</span>();<br><br><span class="hljs-comment">// 时间可视化参数，使用与图片一致的调色板</span><br><span class="hljs-keyword">var</span> timeVisParams = {<br>  <span class="hljs-attr">palette</span>: [<span class="hljs-string">'#4575b4'</span>, <span class="hljs-string">'#74add1'</span>, <span class="hljs-string">'#abd9e9'</span>, <span class="hljs-string">'#e0f3f8'</span>, <span class="hljs-string">'#ffffbf'</span>, <span class="hljs-string">'#fee090'</span>, <span class="hljs-string">'#fdae61'</span>, <span class="hljs-string">'#f46d43'</span>, <span class="hljs-string">'#d73027'</span>], <span class="hljs-comment">// 蓝到红渐变</span><br>  <span class="hljs-attr">min</span>: start,<br>  <span class="hljs-attr">max</span>: end<br>};<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(firstChange, timeVisParams, <span class="hljs-string">'First change'</span>);<br><br><span class="hljs-comment">// 获取该时间段内最后一次变化</span><br><span class="hljs-keyword">var</span> lastChange = dates<br>  .<span class="hljs-title function_">arraySlice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">arrayFlatten</span>([[<span class="hljs-string">'lastChange'</span>]])<br>  .<span class="hljs-title function_">selfMask</span>();<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(lastChange, timeVisParams, <span class="hljs-string">'Last change'</span>);<br><br><span class="hljs-comment">// 获取已掩膜的幅度</span><br><span class="hljs-keyword">var</span> magnitudes = results<br>  .<span class="hljs-title function_">select</span>(<span class="hljs-string">'SWIR1_magnitude'</span>)<br>  .<span class="hljs-title function_">arrayMask</span>(mask).<span class="hljs-title function_">arrayPad</span>([<span class="hljs-number">1</span>]);<br><br><span class="hljs-comment">// 获取最大绝对变化幅度的索引</span><br><span class="hljs-keyword">var</span> maxIndex = magnitudes<br>  .<span class="hljs-title function_">abs</span>()<br>  .<span class="hljs-title function_">arrayArgmax</span>()<br>  .<span class="hljs-title function_">arrayFlatten</span>([[<span class="hljs-string">'index'</span>]]);<br><br><span class="hljs-comment">// 选择最大幅度及其时间</span><br><span class="hljs-keyword">var</span> selectedMag = magnitudes.<span class="hljs-title function_">arrayGet</span>(maxIndex);<br><span class="hljs-keyword">var</span> selectedTbreak = dates.<span class="hljs-title function_">arrayGet</span>(maxIndex).<span class="hljs-title function_">selfMask</span>();<br><br><span class="hljs-comment">// 幅度可视化参数</span><br><span class="hljs-keyword">var</span> magVisParams = {<br>  <span class="hljs-attr">palette</span>: [<span class="hljs-string">'#4575b4'</span>, <span class="hljs-string">'#74add1'</span>, <span class="hljs-string">'#abd9e9'</span>, <span class="hljs-string">'#e0f3f8'</span>, <span class="hljs-string">'#ffffbf'</span>, <span class="hljs-string">'#fee090'</span>, <span class="hljs-string">'#fdae61'</span>, <span class="hljs-string">'#f46d43'</span>, <span class="hljs-string">'#d73027'</span>], <span class="hljs-comment">// 蓝到红渐变</span><br>  <span class="hljs-attr">min</span>: -<span class="hljs-number">0.15</span>,<br>  <span class="hljs-attr">max</span>: <span class="hljs-number">0.15</span><br>};<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(selectedMag, magVisParams, <span class="hljs-string">'Max mag'</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(selectedTbreak, timeVisParams, <span class="hljs-string">'Time of max mag'</span>);<br><br><span class="hljs-comment">// 添加图例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">addLegend</span>(<span class="hljs-params">title, palette, min, max</span>) {<br>  <span class="hljs-comment">// 创建图例面板</span><br>  <span class="hljs-keyword">var</span> legend = ui.<span class="hljs-title class_">Panel</span>({<br>    <span class="hljs-attr">style</span>: {<br>      <span class="hljs-attr">position</span>: <span class="hljs-string">'bottom-left'</span>,<br>      <span class="hljs-attr">padding</span>: <span class="hljs-string">'8px 15px'</span><br>    }<br>  });<br><br>  <span class="hljs-comment">// 添加标题</span><br>  <span class="hljs-keyword">var</span> legendTitle = ui.<span class="hljs-title class_">Label</span>({<br>    <span class="hljs-attr">value</span>: title,<br>    <span class="hljs-attr">style</span>: {<span class="hljs-attr">fontWeight</span>: <span class="hljs-string">'bold'</span>, <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'14px'</span>, <span class="hljs-attr">margin</span>: <span class="hljs-string">'0 0 4px 0'</span>, <span class="hljs-attr">padding</span>: <span class="hljs-string">'0'</span>}<br>  });<br>  legend.<span class="hljs-title function_">add</span>(legendTitle);<br><br>  <span class="hljs-comment">// 创建调色板条</span><br>  <span class="hljs-keyword">var</span> makeColorBar = <span class="hljs-keyword">function</span>(<span class="hljs-params">palette</span>) {<br>    <span class="hljs-keyword">return</span> ui.<span class="hljs-title class_">Thumbnail</span>({<br>      <span class="hljs-attr">image</span>: ee.<span class="hljs-property">Image</span>.<span class="hljs-title function_">pixelLonLat</span>().<span class="hljs-title function_">select</span>(<span class="hljs-number">0</span>)<br>        .<span class="hljs-title function_">multiply</span>((max - min) / <span class="hljs-number">100.0</span>).<span class="hljs-title function_">add</span>(min)<br>        .<span class="hljs-title function_">visualize</span>({<span class="hljs-attr">min</span>: min, <span class="hljs-attr">max</span>: max, <span class="hljs-attr">palette</span>: palette}),<br>      <span class="hljs-attr">params</span>: {<span class="hljs-attr">bbox</span>: <span class="hljs-string">'0,0,100,10'</span>, <span class="hljs-attr">dimensions</span>: <span class="hljs-string">'100x10'</span>},<br>      <span class="hljs-attr">style</span>: {<span class="hljs-attr">stretch</span>: <span class="hljs-string">'horizontal'</span>, <span class="hljs-attr">margin</span>: <span class="hljs-string">'0px 8px'</span>}<br>    });<br>  };<br>  legend.<span class="hljs-title function_">add</span>(<span class="hljs-title function_">makeColorBar</span>(palette));<br><br>  <span class="hljs-comment">// 添加最小值和最大值标签</span><br>  <span class="hljs-keyword">var</span> legendLabels = ui.<span class="hljs-title class_">Panel</span>({<br>    <span class="hljs-attr">widgets</span>: [<br>      ui.<span class="hljs-title class_">Label</span>(min, {<span class="hljs-attr">margin</span>: <span class="hljs-string">'4px 8px'</span>, <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'12px'</span>}),<br>      ui.<span class="hljs-title class_">Label</span>((min + max) / <span class="hljs-number">2</span>, {<span class="hljs-attr">margin</span>: <span class="hljs-string">'4px 8px'</span>, <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'12px'</span>, <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attr">stretch</span>: <span class="hljs-string">'horizontal'</span>}),<br>      ui.<span class="hljs-title class_">Label</span>(max, {<span class="hljs-attr">margin</span>: <span class="hljs-string">'4px 8px'</span>, <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'12px'</span>})<br>    ],<br>    <span class="hljs-attr">layout</span>: ui.<span class="hljs-property">Panel</span>.<span class="hljs-property">Layout</span>.<span class="hljs-title function_">flow</span>(<span class="hljs-string">'horizontal'</span>)<br>  });<br>  legend.<span class="hljs-title function_">add</span>(legendLabels);<br><br>  <span class="hljs-comment">// 将图例添加到地图上</span><br>  <span class="hljs-title class_">Map</span>.<span class="hljs-title function_">add</span>(legend);<br>}<br><br><span class="hljs-comment">// 添加两个图例</span><br><span class="hljs-title function_">addLegend</span>(<span class="hljs-string">'时间 (年份)'</span>, [<span class="hljs-string">'#4575b4'</span>, <span class="hljs-string">'#74add1'</span>, <span class="hljs-string">'#abd9e9'</span>, <span class="hljs-string">'#e0f3f8'</span>, <span class="hljs-string">'#ffffbf'</span>, <span class="hljs-string">'#fee090'</span>, <span class="hljs-string">'#fdae61'</span>, <span class="hljs-string">'#f46d43'</span>, <span class="hljs-string">'#d73027'</span>], start, end);<br><span class="hljs-title function_">addLegend</span>(<span class="hljs-string">'变化幅度'</span>, [<span class="hljs-string">'#4575b4'</span>, <span class="hljs-string">'#74add1'</span>, <span class="hljs-string">'#abd9e9'</span>, <span class="hljs-string">'#e0f3f8'</span>, <span class="hljs-string">'#ffffbf'</span>, <span class="hljs-string">'#fee090'</span>, <span class="hljs-string">'#fdae61'</span>, <span class="hljs-string">'#f46d43'</span>, <span class="hljs-string">'#d73027'</span>], -<span class="hljs-number">0.15</span>, <span class="hljs-number">0.15</span>);<br><br><span class="hljs-comment">// 设置导出函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">exportLayer</span>(<span class="hljs-params">image, description, region, scale</span>) {<br>  <span class="hljs-title class_">Export</span>.<span class="hljs-property">image</span>.<span class="hljs-title function_">toDrive</span>({<br>    <span class="hljs-attr">image</span>: image,<br>    <span class="hljs-attr">description</span>: description,<br>    <span class="hljs-attr">folder</span>: <span class="hljs-string">'GEE_Exports'</span>,  <span class="hljs-comment">// 设置导出文件夹名称</span><br>    <span class="hljs-attr">fileNamePrefix</span>: description,<br>    <span class="hljs-attr">region</span>: region,<br>    <span class="hljs-attr">scale</span>: scale,<br>    <span class="hljs-attr">crs</span>: <span class="hljs-string">'EPSG:4326'</span>,  <span class="hljs-comment">// 选择投影坐标系统 (可以根据需求更改)</span><br>    <span class="hljs-attr">maxPixels</span>: <span class="hljs-number">1e8</span>  <span class="hljs-comment">// 设置最大像素数，避免过大的图像</span><br>  });<br>}<br><br><span class="hljs-comment">// 导出研究区为Shapefile</span><br><span class="hljs-title class_">Export</span>.<span class="hljs-property">table</span>.<span class="hljs-title function_">toDrive</span>({<br>  <span class="hljs-attr">collection</span>: studyRegion,<br>  <span class="hljs-attr">description</span>: <span class="hljs-string">'studyRegion_export'</span>,<br>  <span class="hljs-attr">fileFormat</span>: <span class="hljs-string">'SHP'</span> <span class="hljs-comment">// 或选择'CSV'进行CSV格式导出</span><br>});<br><br><span class="hljs-comment">// 导出“第一次变化”</span><br><span class="hljs-title function_">exportLayer</span>(firstChange, <span class="hljs-string">'firstChange'</span>, studyRegion, <span class="hljs-number">30</span>);<br><br><span class="hljs-comment">// 导出“最后一次变化”</span><br><span class="hljs-title function_">exportLayer</span>(lastChange, <span class="hljs-string">'lastChange'</span>, studyRegion, <span class="hljs-number">30</span>);<br><br><span class="hljs-comment">// 导出“断点数”</span><br><span class="hljs-title function_">exportLayer</span>(numBreaks, <span class="hljs-string">'numBreaks'</span>, studyRegion, <span class="hljs-number">30</span>);<br><br><span class="hljs-comment">// 导出“最大幅度”</span><br><span class="hljs-title function_">exportLayer</span>(selectedMag, <span class="hljs-string">'selectedMag'</span>, studyRegion, <span class="hljs-number">30</span>);<br><br><span class="hljs-comment">// 导出“最大幅度变化的时间”</span><br><span class="hljs-title function_">exportLayer</span>(selectedTbreak, <span class="hljs-string">'selectedTbreak'</span>, studyRegion, <span class="hljs-number">30</span>);<br></code></pre></td></tr></tbody></table></figure>

<h4><span id="%E6%97%B6%E9%97%B4%E7%B2%BE%E5%BA%A6%E5%88%86%E6%9E%90">时间精度分析</span></h4><p>以1990-2000年为例</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 加载所需的库</span><br><span class="hljs-keyword">var</span> palettes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'users/gena/packages:palettes'</span>);<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'users/parevalo_bu/gee-ccdc-tools:ccdcUtilities/api'</span>);<br><span class="hljs-keyword">var</span> eevs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'users/949384116/lib:ImageVisualization/VectorStyle'</span>);<br><br><span class="hljs-comment">// 载入研究区域</span><br><span class="hljs-keyword">var</span> studyRegion = table.<span class="hljs-title function_">filter</span>(ee.<span class="hljs-property">Filter</span>.<span class="hljs-title function_">eq</span>(<span class="hljs-string">'县'</span>, <span class="hljs-string">'武隆区'</span>));<br><span class="hljs-keyword">var</span> styling = {<span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>, <span class="hljs-attr">fillColor</span>: <span class="hljs-string">'00000000'</span>};<br><br><span class="hljs-comment">// 加载并显示研究区边界</span><br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(studyRegion.<span class="hljs-title function_">style</span>(styling), {}, <span class="hljs-string">'wlq'</span>);<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">centerObject</span>(studyRegion, <span class="hljs-number">10</span>);<br><span class="hljs-keyword">var</span> roi = region;<br><span class="hljs-title class_">Map</span>.<span class="hljs-title function_">addLayer</span>(roi, {}, <span class="hljs-string">'Vector Boundary'</span>);<br><br><span class="hljs-comment">// 可视化参数定义（用于显示图像）</span><br><span class="hljs-keyword">var</span> imageVisParam = {<br>  <span class="hljs-attr">bands</span>: [<span class="hljs-string">'RED'</span>, <span class="hljs-string">'GREEN'</span>, <span class="hljs-string">'BLUE'</span>],  <span class="hljs-comment">// 红、绿、蓝波段</span><br>  <span class="hljs-attr">min</span>: <span class="hljs-number">0.035422677884432444</span>,  <span class="hljs-comment">// 最小值</span><br>  <span class="hljs-attr">max</span>: <span class="hljs-number">0.2843901724163326</span>,  <span class="hljs-comment">// 最大值</span><br>  <span class="hljs-attr">gamma</span>: <span class="hljs-number">2.024</span>,  <span class="hljs-comment">// 伽马值</span><br>  <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>  <span class="hljs-comment">// 不透明度</span><br>};<br><br><span class="hljs-comment">// 加载 CCDC 结果影像</span><br><span class="hljs-keyword">var</span> ccdcresult = image;  <span class="hljs-comment">// CCDC 结果影像路径</span><br><span class="hljs-keyword">var</span> ccdc = ee.<span class="hljs-title class_">Image</span>(ccdcresult);  <span class="hljs-comment">// 转换为 ee.Image 对象</span><br><br><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">BANDS</span> = [<span class="hljs-string">'BLUE'</span>, <span class="hljs-string">'GREEN'</span>, <span class="hljs-string">'RED'</span>];<br><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">SEGS</span> = [<span class="hljs-string">'S1'</span>, <span class="hljs-string">'S2'</span>, <span class="hljs-string">'S3'</span>, <span class="hljs-string">'S4'</span>, <span class="hljs-string">'S5'</span>, <span class="hljs-string">'S6'</span>, <span class="hljs-string">'S7'</span>, <span class="hljs-string">'S8'</span>, <span class="hljs-string">'S9'</span>, <span class="hljs-string">'S10'</span>];<br><br><span class="hljs-comment">// 构建 CCDC 影像</span><br><span class="hljs-keyword">var</span> ccdImage = utils.<span class="hljs-property">CCDC</span>.<span class="hljs-title function_">buildCcdImage</span>(ccdc, <span class="hljs-variable constant_">SEGS</span>.<span class="hljs-property">length</span>, <span class="hljs-variable constant_">BANDS</span>);<br><br><span class="hljs-comment">// 生成 1990-2000 年的遥感图像</span><br><span class="hljs-comment">//for (var year = 1990; year &lt;= 2000; year++) {</span><br>  <span class="hljs-comment">//var inputDate = year + '-07-15';</span><br>  <span class="hljs-comment">//downloadsampleImage(inputDate);</span><br><span class="hljs-comment">//}</span><br><br><span class="hljs-comment">// 下载样本图像函数</span><br><span class="hljs-comment">//function downloadsampleImage(inputDate) {</span><br>  <span class="hljs-comment">//var dateParams = { inputFormat: 3, inputDate: inputDate, outputFormat: 1 };</span><br>  <span class="hljs-comment">//var formattedDate = utils.Dates.convertDate(dateParams);</span><br>  <span class="hljs-comment">//var synt = utils.CCDC.getMultiSynthetic(ccdImage.clip(roi), formattedDate, 1, BANDS, SEGS);</span><br>  <span class="hljs-comment">//var trueColor321 = synt.select(['RED', 'GREEN', 'BLUE']);</span><br>  <span class="hljs-comment">//Map.addLayer(trueColor321, imageVisParam, 'True Color (321) ' + inputDate);</span><br><span class="hljs-comment">//}</span><br><br><span class="hljs-comment">// 合并样本点</span><br><span class="hljs-keyword">var</span> sample_year = year1991.<span class="hljs-title function_">merge</span>(year1992).<span class="hljs-title function_">merge</span>(year1993).<span class="hljs-title function_">merge</span>(year1994)<br>  .<span class="hljs-title function_">merge</span>(year1995).<span class="hljs-title function_">merge</span>(year1996).<span class="hljs-title function_">merge</span>(year1997).<span class="hljs-title function_">merge</span>(year1998).<span class="hljs-title function_">merge</span>(year1999)<br>  .<span class="hljs-title function_">merge</span>(year2000);<br><br><span class="hljs-title function_">print</span>(sample_year, <span class="hljs-string">'Sample Year Collection'</span>);<br><br><span class="hljs-comment">// 导出到 Asset</span><br><span class="hljs-title class_">Export</span>.<span class="hljs-property">table</span>.<span class="hljs-title function_">toAsset</span>({<br>  <span class="hljs-attr">collection</span>: sample_year,<br>  <span class="hljs-attr">assetId</span>: <span class="hljs-string">'sampleCollection_Year_1990_2000'</span>,<br>});<br><br><span class="hljs-comment">// 加载 CCDC 结果</span><br><span class="hljs-keyword">var</span> ccdcResults = image;<br><br><span class="hljs-comment">// 查看变化波段</span><br><span class="hljs-keyword">var</span> change = image.<span class="hljs-title function_">select</span>(<span class="hljs-string">'tBreak'</span>);<br><span class="hljs-keyword">var</span> changeProb = image.<span class="hljs-title function_">select</span>(<span class="hljs-string">'changeProb'</span>);<br><br><span class="hljs-comment">// 设置时间范围并获取满足条件的地点的掩膜</span><br><span class="hljs-keyword">var</span> start = <span class="hljs-number">1990</span>; <span class="hljs-comment">// 起始年份调整为 2001</span><br><span class="hljs-keyword">var</span> end = <span class="hljs-number">2000</span>;   <span class="hljs-comment">// 结束年份</span><br><span class="hljs-keyword">var</span> mask = change.<span class="hljs-title function_">gt</span>(start).<span class="hljs-title function_">and</span>(change.<span class="hljs-title function_">lte</span>(end)).<span class="hljs-title function_">and</span>(changeProb.<span class="hljs-title function_">eq</span>(<span class="hljs-number">1</span>));<br><br><span class="hljs-comment">// 获取该时间段的断点数</span><br><span class="hljs-keyword">var</span> numBreaks = mask.<span class="hljs-title function_">arrayReduce</span>(ee.<span class="hljs-property">Reducer</span>.<span class="hljs-title function_">sum</span>(), [<span class="hljs-number">0</span>]);<br><br><span class="hljs-comment">// 获取该时间段内第一次变化</span><br><span class="hljs-keyword">var</span> dates = change.<span class="hljs-title function_">arrayMask</span>(mask).<span class="hljs-title function_">arrayPad</span>([<span class="hljs-number">1</span>]);<br><span class="hljs-keyword">var</span> firstChange = dates<br>  .<span class="hljs-title function_">arraySlice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">arrayFlatten</span>([[<span class="hljs-string">'firstChange'</span>]])<br>  .<span class="hljs-title function_">selfMask</span>();<br><br><span class="hljs-comment">// 定义年份到类别标签的映射（2001-2020）</span><br><span class="hljs-keyword">var</span> yearToLabel = {<br>  <span class="hljs-number">1991</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-number">1992</span>: <span class="hljs-number">2</span>,<br>  <span class="hljs-number">1993</span>: <span class="hljs-number">3</span>,<br>  <span class="hljs-number">1994</span>: <span class="hljs-number">4</span>,<br>  <span class="hljs-number">1995</span>: <span class="hljs-number">5</span>,<br>  <span class="hljs-number">1996</span>: <span class="hljs-number">6</span>,<br>  <span class="hljs-number">1997</span>: <span class="hljs-number">7</span>,<br>  <span class="hljs-number">1998</span>: <span class="hljs-number">8</span>,<br>  <span class="hljs-number">1999</span>: <span class="hljs-number">9</span>,<br>  <span class="hljs-number">2000</span>: <span class="hljs-number">10</span>,<br>};<br><br><span class="hljs-comment">// 将样本点的 year 字段转换为类别标签</span><br><span class="hljs-keyword">var</span> sample_year = <span class="hljs-title class_">Year</span>.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">feature</span>) {<br>  <span class="hljs-comment">// 获取年份字段</span><br>  <span class="hljs-keyword">var</span> year = feature.<span class="hljs-title function_">get</span>(<span class="hljs-string">'year'</span>);<br>  <br>  <span class="hljs-comment">// 检查 year 是否存在且不为空</span><br>  <span class="hljs-keyword">var</span> label = ee.<span class="hljs-property">Algorithms</span>.<span class="hljs-title class_">If</span>(<br>    ee.<span class="hljs-property">Algorithms</span>.<span class="hljs-title class_">IsEqual</span>(year, <span class="hljs-literal">null</span>), <span class="hljs-comment">// 如果 year 为空</span><br>    <span class="hljs-number">0</span>, <span class="hljs-comment">// 设置为 0</span><br>    ee.<span class="hljs-title class_">Dictionary</span>(yearToLabel).<span class="hljs-title function_">get</span>(ee.<span class="hljs-title class_">Number</span>(year).<span class="hljs-title function_">toInt</span>()) <span class="hljs-comment">// 否则获取对应的类别标签</span><br>  );<br>  <br>  <span class="hljs-keyword">return</span> feature.<span class="hljs-title function_">set</span>(<span class="hljs-string">'label'</span>, label); <span class="hljs-comment">// 添加新的字段 label</span><br>});<br><span class="hljs-title function_">print</span>(sample_year, <span class="hljs-string">'Collection'</span>);<br><span class="hljs-comment">// 将 CCDC 结果的 firstChange 字段转换为类别标签</span><br><span class="hljs-keyword">var</span> firstChangeInt = firstChange.<span class="hljs-title function_">round</span>(); <span class="hljs-comment">// 将 firstChange 四舍五入为整数</span><br><span class="hljs-comment">// 使用 remap() 将 firstChangeInt 中的年份值映射为对应的类别标签</span><br><span class="hljs-keyword">var</span> firstChangeLabel = firstChangeInt.<span class="hljs-title function_">remap</span>(<br>  [<span class="hljs-number">1991</span>, <span class="hljs-number">1992</span>, <span class="hljs-number">1993</span>, <span class="hljs-number">1994</span>, <span class="hljs-number">1995</span>, <span class="hljs-number">1996</span>, <span class="hljs-number">1997</span>, <span class="hljs-number">1998</span>, <span class="hljs-number">1999</span>, <span class="hljs-number">2000</span>],  <span class="hljs-comment">// 输入的年份</span><br>  [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>],  <span class="hljs-comment">// 对应的类别标签</span><br>  <span class="hljs-number">0</span>  <span class="hljs-comment">// 默认值为 0，表示未映射的年份</span><br>);<br><br><span class="hljs-comment">// 将转换后的 firstChangeLabel 添加到 CCDC 结果中</span><br><span class="hljs-keyword">var</span> ccdcResultsWithLabel = ccdcResults.<span class="hljs-title function_">addBands</span>(firstChangeLabel.<span class="hljs-title function_">rename</span>(<span class="hljs-string">'firstChangeLabel'</span>));<br><br><span class="hljs-comment">// 提取 CCDC 结果到样本点</span><br><span class="hljs-keyword">var</span> extractedValues = ccdcResultsWithLabel.<span class="hljs-title function_">sampleRegions</span>({<br>  <span class="hljs-attr">collection</span>: sample_year,<br>  <span class="hljs-attr">scale</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 根据你的数据分辨率调整</span><br>  <span class="hljs-attr">geometries</span>: <span class="hljs-literal">true</span><br>});<br><br><span class="hljs-comment">// 过滤掉没有有效 label 或 firstChangeLabel 的样本点</span><br><span class="hljs-keyword">var</span> validSamples = extractedValues.<span class="hljs-title function_">filter</span>(ee.<span class="hljs-property">Filter</span>.<span class="hljs-title function_">and</span>(<br>  ee.<span class="hljs-property">Filter</span>.<span class="hljs-title function_">notNull</span>([<span class="hljs-string">'label'</span>]), <span class="hljs-comment">// 确保 label 不为空</span><br>  ee.<span class="hljs-property">Filter</span>.<span class="hljs-title function_">notNull</span>([<span class="hljs-string">'firstChangeLabel'</span>]) <span class="hljs-comment">// 确保 firstChangeLabel 不为空</span><br>));<br><br><span class="hljs-comment">// 打印有效样本点的数量</span><br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Valid Samples Count:'</span>, validSamples.<span class="hljs-title function_">size</span>());<br><br><span class="hljs-comment">// 检查有效样本点的属性</span><br><span class="hljs-title function_">print</span>(<span class="hljs-string">'First Valid Sample:'</span>, validSamples.<span class="hljs-title function_">first</span>());<br><br><span class="hljs-comment">// 计算混淆矩阵</span><br><span class="hljs-keyword">var</span> confusionMatrix = validSamples.<span class="hljs-title function_">errorMatrix</span>({<br>  <span class="hljs-attr">actual</span>: <span class="hljs-string">'label'</span>, <span class="hljs-comment">// 实际类别标签</span><br>  <span class="hljs-attr">predicted</span>: <span class="hljs-string">'firstChangeLabel'</span> <span class="hljs-comment">// 预测类别标签</span><br>});<br><br><span class="hljs-comment">// 打印混淆矩阵</span><br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Confusion Matrix:'</span>, confusionMatrix);<br><br><span class="hljs-comment">// 计算总体精度</span><br><span class="hljs-keyword">var</span> overallAccuracy = confusionMatrix.<span class="hljs-title function_">accuracy</span>();<br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Overall Accuracy:'</span>, overallAccuracy);<br><br><span class="hljs-comment">// 计算 Kappa 系数</span><br><span class="hljs-keyword">var</span> kappa = confusionMatrix.<span class="hljs-title function_">kappa</span>();<br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Kappa:'</span>, kappa);<br><br><span class="hljs-comment">// 计算用户精度和生产者精度</span><br><span class="hljs-keyword">var</span> userAccuracy = confusionMatrix.<span class="hljs-title function_">consumersAccuracy</span>();<br><span class="hljs-keyword">var</span> producerAccuracy = confusionMatrix.<span class="hljs-title function_">producersAccuracy</span>();<br><span class="hljs-title function_">print</span>(<span class="hljs-string">'User Accuracy:'</span>, userAccuracy);<br><span class="hljs-title function_">print</span>(<span class="hljs-string">'Producer Accuracy:'</span>, producerAccuracy);<br></code></pre></td></tr></tbody></table></figure>

</body></html>
	</article>

	 
    <div class="kira-post-copyright">
        <strong>本文作者：</strong>秋月<br>
        <strong>本文链接：</strong><a href="http://example.com/2025/04/27/GEE%E7%9A%84Landtrendr%E5%92%8CCCDC%E7%AE%97%E6%B3%95%E8%AE%A1%E7%AE%97%E6%A4%8D%E8%A2%AB%E6%89%B0%E5%8A%A8/" title="http:&#x2F;&#x2F;example.com&#x2F;2025&#x2F;04&#x2F;27&#x2F;GEE的Landtrendr和CCDC算法计算植被扰动&#x2F;" target="_blank" rel="noopener">http:&#x2F;&#x2F;example.com&#x2F;2025&#x2F;04&#x2F;27&#x2F;GEE的Landtrendr和CCDC算法计算植被扰动&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>

  
	<div class="kira-post-nav">
		<nav class="post-nav">
			      
			<!-- 先找到与当前文字相同的目录 -->
			   
			<!-- 在找到当前文章所在的 index -->
			              
		</nav>
	</div>
	
	<div class="kira-post-meta kira-rainbow">
		
			<a class="kirafont icon-container-fill -link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AD%A6%E4%B9%A0/">代码学习</a>
		
		
			<a class="kirafont icon-tag-fill -none-link" href="/tags/GEE/" rel="tag">GEE</a> <a class="kirafont icon-tag-fill -none-link" href="/tags/JavaScript/" rel="tag">JavaScript</a> <a class="kirafont icon-tag-fill -none-link" href="/tags/%E9%81%A5%E6%84%9F/" rel="tag">遥感</a>
		
	</div>
	
	<div class="kira-post-footer">
		

		
	<div class="giscus"></div>
  
    <script src="https://giscus.app/client.js"
      data-repo="-your github username-/-your giscus repo-"
      data-repo-id="-your giscus repo ID-"
      data-category="Announcements"
      data-category-id="-giscus category id-"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="light"
      data-lang="en"
      data-loading="lazy"
      crossorigin="anonymous"
      async  
    ></script>
  

	</div>
	
</div>

				</div>
			</div>
			<div class="kira-right-column">
	<a onclick="document.querySelector('#kira-top-header').scrollIntoView({behavior: 'smooth'});" class="kira-backtotop" aria-label="回到顶部" title="回到顶部">
		<button class="mdui-fab mdui-ripple">
			<i class="kirafont icon-caret-up"></i>
		</button>
	</a>
</div>

		</div>
	</body>
</html>
